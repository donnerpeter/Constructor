package cons2

import junit.framework.TestCase

/**
 * @author peter
 */
class MotherDaughterTest extends TestCase {

  public void testMLD() throws Exception {
    doResultTest "мать любит дочь", """
V_mother_1[label="sem=mother"];
V_love_1[label="sem=love"];
V_experiencer_1[label="sem=experiencer"];
V_daughter_1[label="sem=daughter"];
V_theme_1[label="sem=theme"];

V_experiencer_1 -> V_love_1; V_experiencer_1 -> V_mother_1;
V_theme_1 -> V_love_1; V_theme_1 -> V_daughter_1;
"""
  }

  public void testMLDEnglish() throws Exception {
    doEnglishTest "the mother loves the daughter", """
V_mother_1[label="sem=mother"];
V_love_1[label="sem=love"];
V_experiencer_1[label="sem=experiencer"];
V_theme_1[label="sem=theme"];
V_daughter_1[label="sem=daughter"];

V_experiencer_1 -> V_love_1; V_experiencer_1 -> V_mother_1;
V_theme_1 -> V_love_1; V_theme_1 -> V_daughter_1;
"""
  }

  public void testMLDTrans() throws Exception {
    doTranslationTest "мать любит дочь", "the mother loves the daughter"
  }

  public void testDLMTrans() throws Exception {
    doTranslationTest "дочь любит мать", "the daughter loves the mother"
  }
  public void testDLM() throws Exception {
    doResultTest "дочь любит мать", """
V_daughter_1[label="sem=daughter"];
V_love_1[label="sem=love"];
V_experiencer_1[label="sem=experiencer"];
V_mother_1[label="sem=mother"];
V_theme_1[label="sem=theme"];

V_experiencer_1 -> V_love_1; V_experiencer_1 -> V_daughter_1;
V_theme_1 -> V_love_1; V_theme_1 -> V_mother_1;
"""
  }

  public void testBnDLM() throws Exception {
    doResultTest "красивая дочь любит мать", """
V_beautiful_1[label="sem=beautiful"];
V_property_host_1[label="sem=property_host"];
V_daughter_1[label="sem=daughter"];
V_love_1[label="sem=love"];
V_experiencer_1[label="sem=experiencer"];
V_mother_1[label="sem=mother"];
V_theme_1[label="sem=theme"];

V_property_host_1 -> V_beautiful_1; V_property_host_1 -> V_daughter_1;
V_experiencer_1 -> V_love_1; V_experiencer_1 -> V_daughter_1;
V_theme_1 -> V_love_1; V_theme_1 -> V_mother_1;
"""
  }

  public void testBnDLMTrans() throws Exception {
    doTranslationTest "красивая дочь любит мать", "the beautiful daughter loves the mother"
  }
  public void testDLBaM() throws Exception {
    doResultTest "дочь любит красивую мать", """
V_daughter_1[label="sem=daughter"];
V_love_1[label="sem=love"];
V_experiencer_1[label="sem=experiencer"];
V_beautiful_1[label="sem=beautiful"];
V_property_host_1[label="sem=property_host"];
V_theme_1[label="sem=theme"];
V_mother_1[label="sem=mother"];

V_experiencer_1 -> V_love_1; V_experiencer_1 -> V_daughter_1;
V_property_host_1 -> V_beautiful_1; V_property_host_1 -> V_mother_1;
V_theme_1 -> V_love_1; V_theme_1 -> V_mother_1;
"""
  }

  public void testDLBaMTrans() throws Exception {
    doTranslationTest "дочь любит красивую мать", "the daughter loves the beautiful mother"
  }

  public void testDLFTrans() throws Exception {
    doTranslationTest "дочь любит отца", "the daughter loves the father"
  }

  public void testFLDTrans() throws Exception {
    doTranslationTest "отец любит дочь", "the father loves the daughter"
  }

  public void testDLF() throws Exception {
    doResultTest "дочь любит отца", """
V_daughter_1[label="sem=daughter"];
V_love_1[label="sem=love"];
V_experiencer_1[label="sem=experiencer"];
V_father_1[label="sem=father"];
V_theme_1[label="sem=theme"];

V_experiencer_1 -> V_love_1; V_experiencer_1 -> V_daughter_1;
V_theme_1 -> V_love_1; V_theme_1 -> V_father_1;
"""
  }

  public void testFLD() throws Exception {
    doResultTest "отец любит дочь", """
V_father_1[label="sem=father"];
V_love_1[label="sem=love"];
V_experiencer_1[label="sem=experiencer"];
V_daughter_1[label="sem=daughter"];
V_theme_1[label="sem=theme"];

V_experiencer_1 -> V_love_1; V_experiencer_1 -> V_father_1;
V_theme_1 -> V_love_1; V_theme_1 -> V_daughter_1;
"""
  }

  public void testFaLD() throws Exception {
    doResultTest "отца любит дочь", """
V_father_1[label="sem=father"];
V_love_1[label="sem=love"];
V_theme_1[label="sem=theme"];
V_daughter_1[label="sem=daughter"];
V_experiencer_1[label="sem=experiencer"];

V_theme_1 -> V_love_1; V_theme_1 -> V_father_1;
V_experiencer_1 -> V_love_1; V_experiencer_1 -> V_daughter_1;
"""
  }

  public void testBaMaLD() throws Exception {
    doResultTest "красивую мать любит дочь", """
V_beautiful_1[label="sem=beautiful"];
V_property_host_1[label="sem=property_host"];
V_mother_1[label="sem=mother"];
V_love_1[label="sem=love"];
V_theme_1[label="sem=theme"];
V_daughter_1[label="sem=daughter"];
V_experiencer_1[label="sem=experiencer"];

V_property_host_1 -> V_beautiful_1; V_property_host_1 -> V_mother_1;
V_theme_1 -> V_love_1; V_theme_1 -> V_mother_1;
V_experiencer_1 -> V_love_1; V_experiencer_1 -> V_daughter_1;
"""
  }
  
  public void testMaLBnDLog() throws Exception {
    doTest "мать любит красивая дочь", """
frame: sem=mother
frame
frame ^1 ^2
^2: sem=love
^2: sem=experiencer
frame
frame
frame ^2 ^1
^3: sem=beautiful
^2: sem=property_host
frame: sem=daughter, ==^4
^8: sem=null
^12: sem=null
^9: weaken
frame ^3 ^2
frame ^4 ^5
^2: sem=theme
^2: sem=experiencer
^7: sem=love
"""
  }

  public void testMaLBnDResult() throws Exception {
    doResultTest "мать любит красивая дочь", """
V_love_1[label="sem=love"];
V_beautiful_1[label="sem=beautiful"];
V_property_host_1[label="sem=property_host"];
V_daughter_1[label="sem=daughter"];
V_theme_1[label="sem=theme"];
V_experiencer_1[label="sem=experiencer"];

V_property_host_1 -> V_beautiful_1; V_property_host_1 -> V_daughter_1;
V_theme_1 -> V_love_1; V_theme_1 -> null;
V_experiencer_1 -> V_love_1; V_experiencer_1 -> V_daughter_1;
"""
  }

  public void testDaLFn() throws Exception {
    doResultTest "дочь любит отец", """
V_love_1[label="sem=love"];
V_father_1[label="sem=father"];
V_theme_1[label="sem=theme"];
V_experiencer_1[label="sem=experiencer"];

V_theme_1 -> V_love_1; V_theme_1 -> null;
V_experiencer_1 -> V_love_1; V_experiencer_1 -> V_father_1;
"""
  }

  private def doTest(String input, String expected) {
    def chart = new Parser(new Russian()).parse(input)
    assertEquals expected.trim() + "\n", chart.presentableLog().trim() + "\n"
  }

  private def doResultTest(String input, String expected) {
    def chart = new Parser(new Russian()).parse(input)
    assertEquals Chart.resultPrefix + expected.trim() + "\n" + Chart.resultSuffix + "\n", chart.presentableResult().trim() + "\n"
  }

  private def doTranslationTest(String rus, String eng) {
    translate(new Russian(), new English(), rus, eng)
    translate(new English(), new Russian(), eng, rus)
  }

  private def translate(Language srcLanguage, Language dstLanguage, String src, String expected) {
    def chart = new Parser(srcLanguage).parse(src)
    def desired = new Transfer().transfer(chart)
    def dst = new Chart(dstLanguage)
    dstLanguage.generate(desired, dst)
    def actual = dst.phonString()
    if (expected != actual) {
      println "Original analysis:\n" + chart.presentableLog()
      println "-------------\nTransferred:\n" + dst.log.presentable(['phon', 'syn', 'sem', 'stem'])
      assertEquals expected, actual
    }
  }

  private def doEnglishTest(String input, String expected) {
    def chart = new Parser(new English()).parse(input)
    assertEquals Chart.resultPrefix + expected.trim() + "\n" + Chart.resultSuffix + "\n", chart.presentableResult().trim() + "\n"
  }

}
