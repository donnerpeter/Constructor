package cons3

import junit.framework.TestCase

/**
 * @author peter
 */
class SonnetTest extends TestCase {

  public void testParse1() throws Exception {
    doParseTest("Удивительный случай случился со мной: я вдруг забыл, что идет раньше - 7 или 8", """
A.property:=AMAZING
A.type:=THING
B.type:=HAPPEN
this.time==PAST
B.arg1:=A
C.type==ME
B.experiencer:=C
this.elaboration:=#2
--
A.type==ME
B.manner:=SUDDENLY
B.type:=FORGET
this.time==PAST
B.arg1:=A
B.theme:=#3
--
this.questioned:=A
this.time==PRESENT
B.type==COME_SCALARLY
B.order==EARLIER
B.arg1==A
A.variant==7
A.variant==8
""")
  }

  private void doParseTest(String input, String expected) {
    assertEquals expected.trim(), new Parser().parse(input).presentable()
  }

  public void testParse2() throws Exception {
    doParseTest "Я отправился к соседям и спросил их, что они думают по этому поводу", """
A.type==ME
B.type:=GO_OFF
this.time==PAST
B.arg1:=A
C.type==NEIGHBOURS
B.goal:=C
D.type:=ASK
D.arg1:=A
E.type==THEY
D.arg2:=E
D.question:=#2
--
this.questioned:=A
B.type==THEY
C.type==THINK
this.time==PRESENT
C.arg1==B
C.arg2==A
D.determiner==THIS
C.topic==D
D.type==MATTER
"""
  }

  public void testParse3() throws Exception {
    doParseTest "Каково же было их и мое удивление, когда они вдруг обнаружили, что тоже не могут вспомнить порядок счета", """
this.exclamation:=A
B.degree:=A
this.time==PAST
C.type==THEY
D.type==ME
B.type:=AMAZE
B.arg1:=C
B.arg1:=D
B.theme==#2
--
A.type==THEY
B.manner:=SUDDENLY
B.type:=DISCOVER
this.time==PAST
B.arg1:=A
B.theme:=#3
--
A.type:=ALSO
A.arg1:=B
A.theme:=C
C.negated==true
C.type==CAN
this.time==PRESENT
B.type==THEY
C.theme==D
D.type==REMEMBER
E.type==ORDER
D.arg2==E
F.type==COUNTING
E.criterion==F
"""
  }

  public void testTranslate1() throws Exception {
    doTranslateTest "Удивительный случай случился со мной: я вдруг забыл, что идет раньше - 7 или 8",
                    "An amazing thing happened to me today, I suddenly forgot what comes first - 7 or 8"
  }

  public void testTranslate2() throws Exception {
    doTranslateTest "Я отправился к соседям и спросил их, что они думают по этому поводу",
                    "I went to my neighbors and asked them about their opinion on this matter"
  }

  public void testTranslate3() throws Exception {
    doTranslateTest "Каково же было их и мое удивление, когда они вдруг обнаружили, что тоже не могут вспомнить порядок счета",
                    "Great was their and my amazement, when they suddenly discovered, that they couldn't recall the counting order"
  }

  static void doTranslateTest(String input, String expected) {
    def chart = new Parser().parse(input)
    def actual = new EnglishGenerator().generate(chart)
    if (actual != expected) {
      println chart.presentable()
    }
    assertEquals expected, actual
  }
}
