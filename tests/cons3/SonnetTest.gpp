package cons3

import junit.framework.TestCase

/**
 * @author peter
 */
class SonnetTest extends TestCase {

  public void testParse1() throws Exception {
    doParseTest("Удивительный случай случился со мной: я вдруг забыл, что идет раньше - 7 или 8", """
A.property=AMAZING
A.type=THING
A.given=false
B.type=HAPPEN
#1.time=PAST
B.arg1=A
B.experiencer=C
C.type=ME
#1.elaboration=#2
--
A.type=ME
B.manner=SUDDENLY
B.type=FORGET
#2.time=PAST
B.arg1=A
B.theme=#3
--
#3.questioned=A
#3.time=PRESENT
B.type=COME_SCALARLY
B.order=EARLIER
B.arg1=A
C.type=7
C.number=true
A.variants=D
D.member=C
D.conj=or
E.type=8
E.number=true
D.member=E
""")
  }

  static void doParseTest(String input, String expected) {
    def parser = new Parser()
    def result = parser.parse(input).presentable()
    if (expected.trim() != result) {
      parser.parse(input, true)
      assertEquals expected.trim(), result
    }
  }

  public void testParse2() throws Exception {
    doParseTest "Я отправился к соседям и спросил их, что они думают по этому поводу", """
A.type=ME
B.type=GO_OFF
#1.time=PAST
B.arg1=A
B.goal=C
C.type=NEIGHBOURS
D.type=ASK
D.arg1=A
E.type=THEY
D.arg2=E
D.question=#2
--
#2.questioned=A
B.type=THEY
C.type=THINK
#2.time=PRESENT
C.arg1=B
C.arg2=A
C.topic=D
D.determiner=THIS
D.type=MATTER
"""
  }

  public void testParse3() throws Exception {
    doParseTest "Каково же было их и мое удивление, когда они вдруг обнаружили, что тоже не могут вспомнить порядок счета.", """
#1.exclamation=A
B.degree=A
#1.time=PAST
C.type=THEY
D.conj=and
E.type=ME
D.member=C
D.member=E
B.type=AMAZE
B.arg1=D
#1.whenCondition=#2
--
A.type=THEY
B.manner=SUDDENLY
B.type=DISCOVER
#2.time=PAST
B.arg1=A
B.theme=#3
--
A.type=ALSO
A.arg1=B
A.theme=C
C.negated=true
C.type=CAN
#3.time=PRESENT
B.type=THEY
C.theme=D
D.type=RECALL
E.type=ORDER
D.arg2=E
F.type=COUNTING
E.criterion=F
#3.dot=true
"""
  }

  public void testParse3_4() throws Exception {
    doParseTest "Каково же было их и мое удивление, когда они вдруг обнаружили, что тоже не могут вспомнить порядок счета. 1, 2, 3, 4, 5 и 6 помнят, а дальше забыли.", """
#1.exclamation=A
B.degree=A
#1.time=PAST
C.type=THEY
D.conj=and
E.type=ME
D.member=C
D.member=E
B.type=AMAZE
B.arg1=D
#1.whenCondition=#2
--
A.type=THEY
B.manner=SUDDENLY
B.type=DISCOVER
#2.time=PAST
B.arg1=A
B.theme=#3
--
A.type=ALSO
A.arg1=B
A.theme=C
C.negated=true
C.type=CAN
#3.time=PRESENT
B.type=THEY
C.theme=D
D.type=RECALL
E.type=ORDER
D.arg2=E
F.type=COUNTING
E.criterion=F
#3.dot=true
--
A.type=1
A.number=true
B.type=2
B.number=true
C.member=A
C.member=B
D.type=3
D.number=true
C.member=D
E.type=4
E.number=true
C.member=E
F.type=5
F.number=true
C.member=F
C.conj=and
G.type=6
G.number=true
C.member=G
H.type=REMEMBER
#4.time=PRESENT
H.arg2=C
I.type=THEY
H.arg1=I
#4.but=#5
--
A.type=NEXT
B.type=FORGET
#5.time=PAST
B.arg2=A
C.type=THEY
B.arg1=C
#5.dot=true
"""
  }

  public void testParse5() throws Exception {
    doParseTest 'Мы все пошли в коммерческий магазин "Гастроном", что на углу Знаменской и Бассейной улицы, и спросили кассиршу о нашем недоумении', """
A.type=WE
A.quantifier=ALL
B.type=GO
#1.time=PAST
B.arg1=A
C.kind=COMMERCIAL
C.type=SHOP
C.given=false
B.goal=C
C.name=Гастроном
C.relative=#2
D.type=ASK
D.arg1=A
E.type=CASHIER
E.given=false
D.arg2=E
D.topic=F
G.type=WE
F.type=PREDICAMENT
F.arg1=G
--
#2.wh=A
A.location=B
B.type=CORNER
C.type=STREET
B.arg1=C
C.name=Знаменская
D.conj=and
E.type=STREET
D.member=C
D.member=E
B.arg1=D
E.name=Бассейная
"""
  }

  public void testParse6() throws Exception {
    doParseTest "Кассирша грустно улыбнулась, вынула изо рта маленький молоточек и, слегка подвигав носом, сказала:", """
A.type=CASHIER
B.manner=SADLY
B.type=SMILE
#1.time=PAST
B.arg1=A
C.type=TAKE_OUT
C.arg1=A
C.source=D
D.type=MOUTH
E.size=LITTLE
C.arg2=E
E.type=HAMMER
E.given=false
F.manner=SLIGHTLY
F.type=MOVE
F.background=perfect
G.type=NOSE
F.arg2=G
H.type=SAY
H.arg1=A
H.message=#2
"""
  }

  public void testParse7() throws Exception {
    doParseTest "По-моему, семь идет после восьми в том случае, когда восемь идет после семи", """
#1.opinion_of=ME
A.type=7
#1.time=PRESENT
B.type=COME_SCALARLY
B.order=AFTER
B.arg1=A
C.type=8
B.anchor=C
D.determiner=THAT
D.type=CASE
#1.condition=D
D.whenCondition=#2
--
A.type=8
#2.time=PRESENT
B.type=COME_SCALARLY
B.order=AFTER
B.arg1=A
C.type=7
B.anchor=C
"""
  }

  public void testParse6_7() throws Exception {
    doParseTest """Кассирша грустно улыбнулась, вынула изо рта маленький молоточек и, слегка подвигав носом, сказала:
- По-моему, семь идет после восьми в том случае, когда восемь идет после семи""", """
A.type=CASHIER
B.manner=SADLY
B.type=SMILE
#1.time=PAST
B.arg1=A
C.type=TAKE_OUT
C.arg1=A
C.source=D
D.type=MOUTH
E.size=LITTLE
C.arg2=E
E.type=HAMMER
E.given=false
F.manner=SLIGHTLY
F.type=MOVE
F.background=perfect
G.type=NOSE
F.arg2=G
H.type=SAY
H.arg1=A
H.message=#2
--
#2.opinion_of=ME
A.type=7
#2.time=PRESENT
B.type=COME_SCALARLY
B.order=AFTER
B.arg1=A
C.type=8
B.anchor=C
D.determiner=THAT
D.type=CASE
#2.condition=D
D.whenCondition=#3
--
A.type=8
#3.time=PRESENT
B.type=COME_SCALARLY
B.order=AFTER
B.arg1=A
C.type=7
B.anchor=C
"""
  }

  public void testParse8() throws Exception {
    doParseTest """Мы поблагодарили кассиршу и с радостью выбежали из магазина""", """
A.type=WE
B.type=THANK
#1.time=PAST
B.arg1=A
C.type=CASHIER
C.given=false
B.arg2=C
D.type=JOY
E.type=RUN_OUT
E.arg1=A
E.mood=D
F.type=SHOP
"""
  }


  public void testTranslate1() throws Exception {
    doTranslateTest "Удивительный случай случился со мной: я вдруг забыл, что идет раньше - 7 или 8",
                    "An amazing thing happened to me today, I suddenly forgot what comes first - 7 or 8"
  }

  public void testTranslate2() throws Exception {
    doTranslateTest "Я отправился к соседям и спросил их, что они думают по этому поводу",
                    "I went to my neighbors and asked them about their opinion on this matter"
  }

  public void testTranslate3() throws Exception {
    doTranslateTest "Каково же было их и мое удивление, когда они вдруг обнаружили, что тоже не могут вспомнить порядок счета.",
                    "Great was their and my amazement, when they suddenly discovered, that they couldn't recall the counting order."
  }

  public void testTranslate4() throws Exception {
    doTranslateTest "1, 2, 3, 4, 5 и 6 помнят, а дальше забыли.",
                    "They remember 1, 2, 3, 4, 5 and 6, but forgot what comes next."
  }

  public void testTranslate3_4() throws Exception {
    doTranslateTest "Каково же было их и мое удивление, когда они вдруг обнаружили, что тоже не могут вспомнить порядок счета. " +
                            "1, 2, 3, 4, 5 и 6 помнят, а дальше забыли.",
                    "Great was their and my amazement, when they suddenly discovered, that they couldn't recall the counting order. " +
                            "They remembered 1, 2, 3, 4, 5 and 6, but forgot what comes next."
  }

  public void testTranslate5() throws Exception {
    doTranslateTest 'Мы все пошли в коммерческий магазин "Гастроном", что на углу Знаменской и Бассейной улицы, и спросили кассиршу о нашем недоумении',
                    "We all went to a commercial grocery store, the one that's on the corner of Znamenskaya and Basseinaya streets to consult a cashier on our predicament"
  }

  public void testTranslate6() throws Exception {
    doTranslateTest 'Кассирша грустно улыбнулась, вынула изо рта маленький молоточек и, слегка подвигав носом, сказала:',
                    "The cashier gave us a sad smile, took a small hammer out of her mouth, and moving her nose slightly back and forth, she said:"
  }

  public void testTranslate7() throws Exception {
    doTranslateTest 'По-моему, семь идет после восьми в том случае, когда восемь идет после семи',
                    "In my opinion, a seven comes after an eight, only if an eight comes after a seven"
  }

  public void testTranslate6_7() throws Exception {
    doTranslateTest '''Кассирша грустно улыбнулась, вынула изо рта маленький молоточек и, слегка подвигав носом, сказала:
- По-моему, семь идет после восьми в том случае, когда восемь идет после семи''',
                    """The cashier gave us a sad smile, took a small hammer out of her mouth, and moving her nose slightly back and forth, she said:
- In my opinion, a seven comes after an eight, only if an eight comes after a seven"""
  }

  static void doTranslateTest(String input, String expected) {
    def chart = new Parser().parse(input)
    def actual = new EnglishGenerator().generate(chart)
    if (actual != expected) {
      println chart.presentable()
    }
    assertEquals expected, actual
  }
}
